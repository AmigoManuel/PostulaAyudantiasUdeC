{% extends 'plataforma/dashboard.html' %}

{% block content %}
    <nav class="navbar navbar-expand mb-4">
        <form action="/postulaciones/ofertas_ayudantias/?search=" class="d-none d-sm-inline-block form-inline mr-auto my-2 my-md-0 mw-100 navbar-search">
            <div class="input-group">
                <input id="ayudantia_search" type="text" class="form-control border-secondary" placeholder="Buscar ayudantía." aria-label="Search" aria-describedby="basic-addon2">
                <div class="input-group-append">
                    <a id="btn_search" href="/postulaciones/ofertas_ayudantias/?search=" class="btn btn-primary" type="button">
                        <i class="fas fa-search fa-sm"></i>
                    </a>
                </div>
            </div>
        </form>
        <ul class="navbar-nav ml-auto">
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Ordenar por
                </a>
                <div class="dropdown-menu dropdown-menu-right animated--grow-in" aria-labelledby="navbarDropdown">
                    <a class="dropdown-item" href="/postulaciones/ofertas_ayudantias/?order=puestos_asc">Puestos disponibles (ascendente)</a>
                    <a class="dropdown-item" href="/postulaciones/ofertas_ayudantias/?order=puestos_des">Puestos disponibles (descendente)</a>
                    <div class="dropdown-divider"></div>
                    <a class="dropdown-item" href="/postulaciones/ofertas_ayudantias/?order=fecha_asc">Fecha de ingreso mas reciente</a>
                    <a class="dropdown-item" href="/postulaciones/ofertas_ayudantias/?order=fecha_des">Fecha de ingreso mas antigua</a>
                </div>
            </li>
        </ul>
    </nav>
    {% if object_list %}
        <div class="card-deck" id="card-columns">
            {% for ayudantia in object_list %}
                <div class="col col-sm-6 mb-4">
                    <div class="card shadow py-2">
                        <div class="card-body">
                            <h3 class="card-title mb-4">{{ ayudantia.curso.nombre }}</h3>
                            <h6 class="card-subtitle mb-2 text-muted">Código: {{ ayudantia.curso.codigo }}</h6>
                            <p class="card-text">Docente: {{ ayudantia.curso.docente }}</p>
                            <p class="card-text">Descripción: {{ ayudantia.descripcion }}</p>
                            <p class="card-text">Horario: {{ ayudantia.horario }}</p>
                            <p class="card-text">Puestos disponibles: {{ ayudantia.puestos }}</p>
                            <div class="text-center">
                                {% if not request.session.es_docente and not request.session.es_administrador %}
                                    <!-- Solo a alumno se le permite postular -->
                                    <a type="button" class="btn btn-block" data-toggle="modal" data-target="#ingresarDatos"
                                       data-cursomodal='{ "id":"{{ ayudantia.id }}", "codigo":"{{ ayudantia.curso.codigo }}" ,"nombre_curso":"{{ ayudantia.curso.nombre }}" }'>Postular</a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}

        </div>
        <div class="modal fade" id="ingresarDatos" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Ingrese Datos </h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form>
                            <div class="form-group">
                                <label for="Semestre" class="col-form-label">Semestre donde aprobó la asignatura:</label>
                                <input type="text" class="form-control" placeholder="Ej: 2019-2" id="Semestre" name="Semestre"/>
                                <label for="Nota" class="col-form-label">Nota:</label>
                                <input class="form-control" placeholder="Ej: 4.3" id="Nota"/>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <form id="form_accept" method="post">
                            {% csrf_token %}
                            <div>
                                <input id="id_ayudantia" type="hidden" value=' ' name="id_ayudantia">
                                <input id="semestre" type="hidden" value=" " name="semestre">
                                <input id="nota" type="hidden" value=" " name="nota">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                                <input id="Boton_enviar" type="submit" class="btn btn-success" value="Enviar"/>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

    {% else %}
        <h1>No hay ofertas de asignaturas para el Semestre actual</h1>
    {% endif %}


{% endblock %}

{% block extrajs %}
    <script>
        $('#ingresarDatos').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget) // Button that triggered the modal
            var recipient = button.data('cursomodal') // Extract info from data-* attributes

            // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
            // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
            var modal = $(this)
            modal.find('.modal-title ').text('Postular a ' + recipient.nombre_curso + "(" + recipient.codigo + ")")

            $("#Boton_enviar").click(function (event) {

                $("#id_ayudantia").val(recipient.id)
                $("#semestre").val($("#Semestre").val())
                $("#nota").val($("#Nota").val())

                $("#form_accept").submit(function () {

                })
            })
        });

        $(document).ready(function () {

            let btn_search = $("#btn_search");

            let borders = ['4px solid coral', '4px solid orange', '4px solid cornflowerblue', '4px solid #6FBB89', '4px solid #B57247'];
            let textColors = ['coral', 'orange', 'cornflowerblue', '#6FBB89', '#B57247'];
            let i = 0;

            $('.card').each(function () {
                $(this).css("border-left", borders[i]);
                $(this).find('.card-title').css("color", textColors[i])
                $(this).find('.btn').css("background-color", textColors[i]);
                $(this).find('.btn').css("color", "white");
                if (i !== textColors.length - 1) {
                    i = i + 1;
                } else {
                    i = 0;
                }
            });

            $("#ayudantia_search").bind("change paste keyup", function () {
                let url = "/postulaciones/ofertas_ayudantias/?search=" + $(this).val();
                btn_search.attr("href", url);
            });
        });
    </script>
{% endblock %}